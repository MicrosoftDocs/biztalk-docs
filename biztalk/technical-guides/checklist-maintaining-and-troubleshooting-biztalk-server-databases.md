---
title: "Checklist: Maintaining and Troubleshooting BizTalk Server Databases | Microsoft Docs"
ms.custom: ""
ms.date: "06/29/2017"
ms.prod: "biztalk-server"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: 4
author: "MandiOhlinger"
ms.author: "mandia"
manager: "anneta"
---
# Checklist: Maintaining and Troubleshooting BizTalk Server Databases
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and their health are very important for a successful [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database messaging environment. This topic lists the steps that you must follow when maintaining or troubleshooting the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.  
  
-   [Maintaining BizTalk Server Databases](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [Troubleshooting BizTalk Server Databases](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## Maintaining BizTalk Server Databases  
  
|Steps|Reference|  
|-----------|---------------|  
|Disable the **Auto Update Statistics** and **Auto Create Statistics** Options (applicable only to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox databases).|**Note:**  These settings are done by default as part of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration. You should not make changes to these settings. <br /><br /> You must disable the **Auto Create Statistics** and the **Auto Update Statistics** options. To determine if these settings are disabled, execute the following stored procedures in SQL Server:<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB', 'auto create statistics'                 exec sp_dboption 'BizTalkMsgBoxDB', 'auto update statistics'<br /><br /> The value returned for **CurrentSetting** should be OFF. If this value returned for **CurrentSetting** is ON, change it to OFF by executing the following stored procedures in SQL Server:<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB', 'auto create statistics', 'off'                 exec sp_dboption 'BizTalkMsgBoxDB', 'auto update statistics', 'off'<br /><br /> For more information about these settings see the following Microsoft Knowledge Base articles:<br /><br /> -   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).<br />-   **912262**—["The auto update statistics option, the auto create statistics option, and the Parallelism setting are turned off in the SQL Server database instance that hosts the BizTalk Server BizTalkMsgBoxDB database"](http://go.microsoft.com/fwlink/?LinkId=153430) (http://go.microsoft.com/fwlink/?LinkId=153430).|  
|Set the Max Degree of Parallelism property|**Note:**  These settings are done by default as part of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration. You should not make changes to these settings. <br /><br /> Set the Max Degree of Parallelism **run_value** and **config_value** properties to a value of one (1) on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances that host the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox databases. To check the Max Degree of Parallelism setting, execute the following stored procedure against the Master database in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> exec sp_configure 'max degree of parallelism'<br /><br /> If the **run_value** and **config_value** are not set to a value of one (1), execute the following stored procedure in SQL Server:<br /><br /> exec sp_configure 'max degree of parallelism', '1'                 reconfigure with override<br /><br /> For more information about how the Max Degree of Parallelism setting affects [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], see the following Microsoft Knowledge Base articles:<br /><br /> -   **899000**—["The Parallelism setting for the instance of SQL Server when you configure BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432).<br />-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).|  
|Determine when you can rebuild [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] indexes|Most of the indexes in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases are clustered (index ID: 1). The DBCC SHOWCONTIG command can be used to display fragmentation information for tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases. These indexes are GUID-based so it is normal for fragmentation to occur. If the Scan Density value of DBCC SHOWCONTIG is less than 30%, the indexes can be rebuilt during downtime. Many tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases contain columns that use DataType definitions where online indexing cannot be done. Therefore, the indexes for tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases should never be rebuilt while BizTalk is processing data. For more information on how to rebuild the BizTalk indexes, see the following Microsoft Knowledge Base article:<br /><br /> -   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).<br /><br /> For more information about index fragmentation and workload types, see the white paper [Microsoft SQL Server 2000 Index Defragmentation Best Practices](http://go.microsoft.com/fwlink/?LinkId=101580) (http://go.microsoft.com/fwlink/?LinkId=101580). **Note:**  You can also use the sys.dm_db_index_physical_stats function to look for fragmentation information in [!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)] and [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]. For more information, see [sys.dm_db_index_physical_stats (Transact-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493).|  
|Monitor the database for locks, blocks, or deadlocks|It is an expected behavior for locks and blocks to occur on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]. However, it is not expected to have these locks or blocks to continue for an extended period of time. Extended blocking and deadlocking on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are indicators of a potential problem. For the current known causes of deadlocking and blocking on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], review the following Microsoft Knowledge Base article:<br /><br /> -   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).|  
|Monitor the size of databases and tables|The size of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database should typically be no more than approximately 5GB.  The BizTalkMsgBoxDb database should not be holding any data, and should be considered a buffer until the data is processed or moved to the BizTalkDTADb database. An environment with a powerful SQL Server backend and numerous long running orchestrations may have a BizTalkMsgBoxDb database larger than 5GB. A high volume environment with no long-running orchestrations should have a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database much smaller than 5GB. The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database can vary greatly in size but if query performance decreases dramatically, then the tracking database is probably too large. As a rule of thumb, a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database larger than 15-20 GB is considered too large and may adversely impact performance. The following issues may be attributable to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases that are too large:<br /><br /> -   The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database continues to grow while the data size (not just the log file) remains large. [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] takes a longer time than normal to process even a simple message flow scenario.<br />-   Group Hub queries take a longer time than normal and may even timeout.<br />-   The database log file never gets truncated.<br />-   The BizTalk SQL Agent jobs run slower than normal.<br />-   Some tables are considerably large or have too many rows compared to normal.<br /><br /> The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases can become large for several reasons including:<br /><br /> -   BizTalk SQL Agent Jobs not running<br />-   Excessive suspended message or service instances<br />-   Disk failures<br />-   High levels of tracking<br />-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] throttling<br />-   Poor [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance<br />-   Network latency issues<br /><br /> Similarly, you can have too many rows in a table. There is no set number of rows that are too many. Additionally, this number of rows varies by what kind of data is stored in the table. For example, a *dta_DebugTrace* table that has more than 1 million rows probably has too many rows. A *HostNameQ_Suspended* table that has more than 200,000 rows probably has too many rows.<br /><br /> Make sure that you know what is expected in your environment to determine whether a data issue is occurring.|  
|Enable tracking on [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] host|By default, tracking is enabled on the default host. BizTalk requires the **Allow Host Tracking** option be checked on a single HOST. When tracking is enabled, the Tracking Data Decode Service (TDDS) moves the tracking event data from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database. If no [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hosts are configured with the option to **Allow Host Tracking** or if the tracking host is stopped, then TDDS will not run and the TrackingData_x_x tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database will grow unchecked. Therefore, a dedicated [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] host should be configured with the option to **Allow Host Tracking**. For more information about configuring a dedicated tracking host see [Configuring a Dedicated Tracking Host](~/technical-guides/configuring-a-dedicated-tracking-host.md). **Note:**  To allow TDDS to maintain new tracking events in high volume scenarios, you can create multiple instances of a single tracking host but no more than one host should be configured for tracking.|  
|Use the correct BizTalk SQL Server Agent jobs|Execution of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL Agent jobs are crucial for managing the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and for maintaining optimal performance.<br /><br /> -   The  **Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]** SQL Server Agent job is the only supported method to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases. This job requires you to set up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases to use a Full Recovery Model. You should configure this job for a healthy [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment. You can use the SQL Server methods to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases only if the SQL Server service is stopped and if all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] processes are stopped. **Note:**      For more information about using the SQL Server full recovery model when configuring the SQL Agent Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job, see [Log Shipping](http://go.microsoft.com/fwlink/?LinkId=153450) (http://go.microsoft.com/fwlink/?LinkId=153450) or [Backup Under the Full Recovery Model](http://go.microsoft.com/fwlink/?LinkId=156509) (http://go.microsoft.com/fwlink/?LinkId=156509).<br />-   The **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job is designed to run indefinitely. As a result the SQL Agent job history may not indicate that this SQL Agent job has successfully completed; this behavior is by design. If there is a failure, the job will restart within 1 minute and continue running unabated. Therefore, failure notifications for this job can typically be ignored. If the job history for the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent job indicates that this job is constantly failing and restarting then further investigation into the cause of the failure/restart cycle may be required.<br />-   The **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server Agent job is the only job that should not be manually enabled because it is initiated by the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb job.<br />-   The **DTA Purge and Archive** SQL Server Agent job maintains the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database by purging and archiving tracked messages. This job reads every row in the table and compares the timestamp of each row to determine if the record should be removed. **Note:**  When troubleshooting the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL Server Agent jobs, verify that all SQL Agent jobs except the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb are completing without errors. <br /><br /> For more information about the [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] SQL Agent Jobs used in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> -   See [Database Structure and Jobs](http://go.microsoft.com/fwlink/?LinkId=153451) (http://go.microsoft.com/fwlink/?LinkId=153451).<br />-   See [Description of the SQL Server Agent jobs in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452).|  
|Monitor and terminate suspended instances|Service instances can be suspended (resumable) or suspended (not resumable). These service instances may be Messaging, Orchestration, or Port. [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] accommodates termination and removal of these instances by using the Group Hub page in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration Console or through the use of the Terminate.vbs script. For more information about the Terminate.vbs script, see [Removing Suspended Service Instance](http://go.microsoft.com/fwlink/?LinkId=153453) (http://go.microsoft.com/fwlink/?LinkId=153453). **Tip:**  You can also use the Terminator tool to remove suspended instances. The [Terminator tool](http://go.microsoft.com/fwlink/?LinkId=151931) is available at [http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931). Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs. Use of this program is entirely at your own risk. <br /><br /> The terms "orphans” and "zombies" are often used interchangeably. An orphaned or zombie message is a message that does not have an associated service instance, typically because the service instance has terminated before the message was received. An orphaned or zombie service is a service that does not have any associated messages. For more information about zombie messages and service instances in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] see [Zombies in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454).|  
|Monitor the performance counters of the **PhysicalDisk** performance object|[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] makes a large number of short, very quick transactions to SQL Server within one minute. If the SQL Server cannot sustain this activity, you may experience [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance issues. Monitor the **Avg. Disk sec/Read**, **Avg. Disk sec/Transfer**, and **Avg. Disk sec/Write** performance monitor counters in the **PhysicalDisk** performance object. The optimal value is less than 10 ms (milliseconds). A value of 20 ms or larger is considered poor performance.<br /><br /> -   For more information about SQL Server 2005 performance, see [Troubleshooting Performance Problems in SQL Server 2005](http://go.microsoft.com/fwlink/?LinkID=153585) (http://go.microsoft.com/fwlink/?LinkID=153585).<br />-   For more information about SQL Server 2008 performance, see [Troubleshooting Performance Problems in SQL Server 2008](http://go.microsoft.com/fwlink/?LinkID=153586) (http://go.microsoft.com/fwlink/?LinkID=153586).<br />-   For more information about [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] database high availability, see [Providing High Availability for BizTalk Server Databases](http://go.microsoft.com/fwlink/?LinkId=153587) (http://go.microsoft.com/fwlink/?LinkId=153587).<br /><br /> You can also refer to the following Microsoft Knowledge Base articles for more information about SQL Server performance:<br /><br /> -   **298475** – ["How to troubleshoot SQL Server performance issues”](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588).<br />-   **271509** – ["How to monitor blocking in SQL Server 2005"](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589).|  
|Follow best practices for [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.|See [Best Practices for Maintaining BizTalk Server Databases](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md).|  
  
<a name="BKMK_Troubleshoot"></a>   
## Troubleshooting BizTalk Server Databases  
 Perform the following tasks to troubleshoot any issues with [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.  
  
|Steps|Reference|  
|-----------|---------------|  
|Ensure all required BizTalk SQL Server Agent jobs are enabled and running|All the BizTalk SQL Server Agent jobs except the **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** job should be enabled and running successfully. Do not disable any other job.<br /><br /> If a failure occurs, use the **View History** option in SQL Server to view the error information, and then troubleshoot the failure accordingly. Remember that the **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job runs infinitely. Therefore, you should only be concerned if the job history reports that the job constantly fails and restarts.|  
|Use the MsgBoxViewer tool to analyze the BizTalk MessageBox and other databases|**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs. Use of this program is entirely at your own risk. <br /><br /> The MsgBoxViewer tool is available from [http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930). The MsgBoxViewer tool is useful for troubleshooting because it provides an HTML report that has detailed information about table sizes and the row count. The report can also help determine whether [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is throttling. Additionally, the tool provides a snapshot of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration.<br /><br /> When [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is running slower than usual, run the MsgBoxViewer tool, click to select all queries on the **Optional Queries** tab, and then review the generated HTML report for any problems. The **Summary Report** section lists warnings in yellow and potential problems in red.<br /><br /> Additionally, you can use the MsgBoxViewer tool to determine which tables are the largest and have the most records. For a list of tables that typically grow the larges and for instructions on how to manage those tables, see [Large-growing BizTalk Server Database Tables](~/technical-guides/large-growing-biztalk-server-database-tables.md).|  
|Use the Terminator tool to resolve issues, if any, identified by the MsgBoxViewer tool|**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs. Use of this program is entirely at your own risk. <br /><br /> Run the Terminator tool available at [Terminator](http://go.microsoft.com/fwlink/?LinkId=151931) (http://go.microsoft.com/fwlink/?LinkId=151931). This tool enables users to easily resolve any issues identified by the BizTalk MsgBoxViewer tool. For more information on how the Terminator tool integrates with the BizTalk MsgBoxViewer tool, see [Using BizTalk Terminator to resolve issues identified by BizTalk MsgBoxViewer](http://go.microsoft.com/fwlink/?LinkId=151932) (http://go.microsoft.com/fwlink/?LinkId=151932).|  
|Investigate deadlock scenarios|In a deadlock scenario, enable DBCC tracing on the SQL Server so that the deadlock information is written to the SQLERROR log.<br /><br /> In SQL Server 2008 or SQL Server 2005, execute the following statement to enable DBCC tracing for deadlock scenarios:<br /><br /> DBCC TRACEON (1222,-1)<br /><br /> You can also use the PSSDIAG utility to collect data on the **Lock:Deadlock** event and the **Lock:Deadlock Chain** event. For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).<br /><br /> The BizTalkMsgBoxDB database is a high-volume and high-transaction Online Transaction Processing (OLTP) database. With such databases, some deadlocking is expected and this deadlocking is handled internally by the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine. When this behavior occurs, no errors are listed in the error logs. When you investigate a deadlock scenario, the deadlock that you are investigating in the output must be correlated with a deadlock error in the event logs.|  
|Look for blocked processes|You can use Activity Monitor in SQL Server to obtain the server process identifier (SPID) of a locking system process. You can then run the SQL Profiler to determine the SQL statement that is executing in the locking SPID. You can use the PSSDIAG utility to troubleshoot locking and blocking issues in SQL Server. The utility captures all the Transact-SQL events that have the blocking script enabled. For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).<br /><br /> In SQL Server 2005 and later versions, you can specify the **blocked process threshold** setting to determine which SPID or SPIDs are blocking longer than the threshold that you specify. For more information about the blocked process threshold option, see [blocked process threshold Option](http://go.microsoft.com/fwlink/?LinkId=153628) (http://go.microsoft.com/fwlink/?LinkId=153628). **Note:**  When you experience a locking or blocking issue in SQL Server, we recommend that you contact Microsoft Customer Support Services. Microsoft Customer Support Services can help you configure the correct PSSDiag utility options.|  
|Delete all unwanted data|If the databases have grown to become too large and if the data contained in the databases will not be required any longer, the preferred method is to delete the data. **Caution:**  Do not use this method in any environment where the data is business critical or if the data is needed. <br /><br /> **To purge the BizTalkMsgBox database**<br /> 1.  Download and install the Terminator tool at [Biztalk Terminator](http://go.microsoft.com/fwlink/?LinkId=220869) (http://go.microsoft.com/fwlink/?LinkId=220869).<br />2.  Follow the steps in the topic [How to Manually Purge Data from the MessageBox Database in a Test Environment](http://go.microsoft.com/fwlink/?LinkID=158064) (http://go.microsoft.com/fwlink/?LinkID=158064) to create the bts_CleanupMsgbox stored procedure in the BizTalk MessageBox database.<br />3.  Use the Terminator tool to execute the bts_CleanupMsgbox stored procedure and purge the BizTalk MessageBox database. **Warning:**      Do not run the bts_CleanupMsgbox stored procedure on a production server that is running BizTalk Server. You should only run the bts_CleanupMsgbox stored procedure in a test environment. Running the bts_CleanupMsgbox stored procedure in a production environment is not supported.<br />4.  Restart all hosts and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.<br /><br /> **To purge the BizTalkDTADb database**<br /> <ul><li>**Method 1**<br /><br /> <ol><li>Back up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</li><li>Execute the **dtasp_PurgeAllCompletedTrackingData** stored procedure. For more information about the stored procedure, see [How to Manually Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkId=153635) (http://go.microsoft.com/fwlink/?LinkId=153635).</li></ol></li><li>**Method 2**. Use this option only if the BizTalkDTADb database contains many incomplete instances that must be removed.<br /><br /> <ol><li>Back up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</li><li>Stop all BizTalk hosts, services, and custom isolated adapters. If you use HTTP or the SOAP adapter, restart the IIS services.</li><li>Execute the **dtasp_CleanHMData** stored procedure on the BizTalkDTADb database.</li><li>Restart all hosts and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.</li></ol></li></ul> **Note:**  If you must have the tracking data, back up the BizTalkDTADb database, restore the database to another SQL Server, and then purge the original BizTalkDTADb database.|  
  
 If you want help analyzing the MsgBoxViewer data or PSSDIAG output, contact Microsoft Customer Support Services. Before you contact Customer Support Services, compress the MsgBoxViewer data, the PSSDIAG output, and the updated event logs (.evt files). You may have to send these files to a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] support engineer  
  
## In This Section  
  
-   [Best Practices for Maintaining BizTalk Server Databases](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [Large-growing BizTalk Server Database Tables](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [Tools and Utilities for Troubleshooting](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## See Also  
 [SQL Server Settings That Should Not Be Changed](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)